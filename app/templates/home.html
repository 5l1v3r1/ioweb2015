{% define "title" %}"Google I/O 2015"{% end %}

{% define "mastheadBgClass" %}bg-medium-grey{% end %}

{% define "masthead" %}
  <h2 class="masthead-title"><i18n-msg msgid="iodate">May 28 - 29</i18n-msg>, 2015</h2>
  <h4 class="masthead-subtitle">Moscone Center West,<br>San Francisco, CA</h4>
{% end %}

{% define "content" %}
  <core-toolbar class="navbar__overlay navbar__overlay--video" aria-hidden="{{!fullscreenVideoActive}}" fit>
    <paper-icon-button icon="arrow-back" on-tap="{{closeVideoCard}}" aria-label="Close video"></paper-icon-button>
    <span flex><i18n-msg msgid="watch-recap-video">Watch the 2014 I/O Recap Video</i18n-msg></span>
  </core-toolbar>

  <div class="card__container card__container--top slide-up">
    <div class="card js-experiment-visualizer">
      <div class="card-content">
        <h3><i18n-msg msgid="io-description">Google I/O is for developersâ€”the creative coders who are building what's next. Together we'll explore the latest in tech, mobile &amp; beyond.</i18n-msg></h3>
      </div>
      <div class="card-content link-spacing">
        <a href="about" data-ajax-link data-anim-card
           data-track-link="home-learn-more-about-io">
            <i18n-msg msgid="learnmore">Learn more about I/O</i18n-msg>
        </a>
        <a href="about#photos" data-ajax-link data-anim-card
           data-track-link="home-io-in-photos">
          <i18n-msg msgid="io-in-photos">I/O in photos</i18n-msg>
        </a>
      </div>
      <div class="ripple">
        <div class="ripple__content"></div>
      </div>
    </div>
  </div>

  <div class="slide-up-delay">
    <section class="home-photo page__section js-experiment-instrument js-experiment-instrument--no-bottom-margin"></section>

    <section id="registration" class="page__section js-experiment-instrument js-experiment-instrument--no-top-margin bg-cyan">
      <h2 tabindex="0"><i18n-msg msgid="registration-opens">Registration begins</i18n-msg><br>March 17 at 9AM PDT</h2>
      <!-- <paper-button class="registration__setreminder" hidden?="{{isPhoneSize}}"
          data-track-link="home-set-reminder">
        <core-icon icon="io:notifications-none"></core-icon> <i18n-msg msgid="setreminder">Set a Reminder</i18n-msg>
      </paper-button> -->

      <div class="io-countdown" layout vertical center>
        <a href="registration" data-ajax-link>
          <countdown-timer bgcolor="#00BCD4"
                           date="Mar 17 2015 09:00:00 GMT-0700 (PDT)"
                           dateadjustment="5" easeintime="490" waittime="100"
                           easeouttime="390" thresholdInformation="{{thresholdInformation}}">
          </countdown-timer>
        </a>

        <template if="{{ thresholdInformation.thresholdDays }}">
          <h4 class="countdown-label">
            <i18n-msg msgid="daysuntilreg">Days until registration begins</i18n-msg>
          </h4>
        </template>

        <template if="{{ thresholdInformation.thresholdHours }}">
          <h4 class="countdown-label">
            <i18n-msg msgid="hoursuntilreg">Hours until registration begins</i18n-msg>
          </h4>
        </template>

        <template if="{{ thresholdInformation.thresholdMinutes }}">
          <h4 class="countdown-label">
            <i18n-msg msgid="minutesuntilreg">Minutes until registration begins</i18n-msg>
          </h4>
        </template>

        <template if="{{ thresholdInformation.thresholdSeconds }}">
          <h4 class="countdown-label">
            <i18n-msg msgid="secondsuntilreg">Seconds until registration begins</i18n-msg>
          </h4>
        </template>
      </div>

    </section>

    <div class="registration__card card__container sidebyside" layout horizontal vertical?="{{isPhoneSize}}">
      <!-- <template if="{{isPhoneSize}}">
        <div class="card js-experiment-visualizer" auto-vertical flex>
          <div class="card-content">
            <a href="#"><core-icon icon="io:notifications-none"></core-icon> <i18n-msg msgid="setreminder">Set a Reminder</i18n-msg></a>
          </div>
        </div>
      </template> -->
      <div class="card js-experiment-visualizer" auto-vertical flex>
        <div class="card-content hide-on-mobile">
          <h3><i18n-msg msgid="io-description-card">I/O is two days of hands-on interaction with the latest technologies, inspirational talks and a few surprises in between.</i18n-msg></h3>
        </div>
        <div class="card-content">
          <a href="schedule" data-ajax-link data-track-link="home-check-agenda"><core-icon icon="event" aria-hidden="true"></core-icon> <i18n-msg msgid="registration-agenda">Check the agenda</i18n-msg></a>
        </div>
      </div>
      <div class="card js-experiment-visualizer" layout vertical auto-vertical flex on-tap="{{playVideo}}" data-track-link="home-watch-2014-recap-video">
        <div flex class="card__photo card__photo--recap"></div>
        <div class="card-content">
          <img src="images/play-video-button.png" class="play__button play__button--card" title="Play video" alt="Play video">
          <span class="anchor-like" role="link" tabindex="0"><i18n-msg msgid="watch-recap-video">Watch the 2014 I/O Recap Video</i18n-msg></span>
        </div>
      </div>
    </div>

    <section class="page__section page__section--attend js-experiment-instrument bg-dark-grey">
      <h2>
        <i18n-msg msgid="attend-from">Attend I/O from</i18n-msg>
        <name-cycler items="{{cycleLocations | keysFilter}}" selectedModel="{{cycledName}}"></name-cycler>
        <br>
        <i18n-msg msgid="attend-wherever">or wherever you may be</i18n-msg>
      </h2>
      <div class="attend__globe">
        <template if="{{pageTransitionDone}}">
          <webgl-globe location="{{cycleLocations[cycledName]}}"
                       locationTarget="{'lat': 36.15, 'lng': 0}"
                       fov="0.3927"
                       offsetY="-0.625"
                       transitionDuration="4000"></webgl-globe>
        </template>
        <div class="globe-marker"></div>
      </div>
    </section>

    <div class="card__container">
      <div class="card js-experiment-visualizer">
        <div class="card-content">
          <h3><i18n-msg msgid="io-extended-invitation">If you aren't able to join us for I/O in person this year, you can still make an event out of it. Host or find an I/O Extended event near you and watch the live stream in the company of other developers.</i18n-msg></h3>
        </div>
        <div class="card-content">
          <a href="offsite" data-ajax-link data-track-link="home-join-from-your-location">
            <i18n-msg msgid="join-from-offsite">Join from your location<i18n-msg>
          </a>
        </div>
      </div>
    </div>

    <section id="join" class="page__section js-experiment-instrument js-experiment-instrument--no-bottom-margin bg-light-grey">
      <h2><i18n-msg msgid="join-convo">Join the conversation now at #io15</i18n-msg></h2>
      <div class="join__social" layout vertical end hidden?="{{isPhoneSize}}">
        <a href="https://plus.google.com/+GoogleDevelopers" data-track-link="home-social-plus-google-developers" target="_blank">
          +googledevelopers<core-icon icon="io:post-gplus"></core-icon>
        </a>
        <a href="https://twitter.com/googledevs" data-track-link="home-social-twitter-google-devs" target="_blank">
          @googledevs<core-icon icon="io:post-twitter"></core-icon>
        </a>
      </div>
      <div class="io__hash" aria-label="I/O hash tag"></div>
      <template if="{{socialPosts.length >= 3}}">
        <div class="sidebyside" layout horizontal vertical?="{{isPhoneSize}}">
          <template repeat="{{socialPost in socialPosts}}">
            <social-post kind="{{socialPost.kind}}"
                         author="{{socialPost.author}}"
                         url="{{socialPost.url}}"
                         text="{{socialPost.text}}"
                         when="{{socialPost.when}}">
            </social-post>
          </template>
        </div>
      </template>
    </section>
  </div>

  <template if="{{fullscreenVideoActive}}">
    <div class="fullvideo__container" fit hidden>
      <img src="images/home/recap-500@2x.jpg" class="fullvideo_thumbnail" alt="Watch the I/O Recap Video" fit>
      <google-youtube videoid="ksvdvCDO7pA" height="100%" width="100%" fit
                      autohide="1" controls="2" modestbranding="1" showinfo="0"
                      iv_load_policy="3" rel="0" autoplay="1"></google-youtube>
    </div>
  </template>

  <script>
  (function() {

    // Page-specific JS that runs when this page is loaded for the first time.
    function initPage() {
      var page = IOWA.Elements.Template.pages[IOWA.Elements.Template.selectedPage];
      var socialPostsEndpoint = 'api/social';
      var socialPostUpdateInterval = 30000; // 30 seconds
      var updateSocialPostsTimeout;

      if (page.hasBeenLoaded) {
        return;
      }

      IOWA.Elements.Template.cycleLocations = {
        'Kyoto': {lat: 35.025699, lng: 135.751147},
        'Chiang Mai': {lat: 18.793553, lng: 98.972353},
        'Calgary': {lat: 50.9535525, lng:-114.5718054},
        'Detroit': {lat: 42.3314,  lng: -83.0458},
        'Porto': {lat: 41.1621,  lng: -8.6220},
        'Nice': {lat: 43.6957891, lng: 7.2701128},
        'Melbourne': {lat: -37.8136,  lng: 144.9631},
        'Kano': {lat: 11.9916085, lng: 8.532064},
        'Durban': {lat: -29.8833,  lng: 31.0500},
        'Porto Alegre': {lat: -30.0331,  lng: -51.2300}
      };

      function updateSocialPosts() {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', socialPostsEndpoint);
        // The request will be intercepted by the service worker, which will use a network-first
        // policy to ensure that the service worker cache is initially ignored.
        // But if the device is offline, it will return the previously cached content.
        xhr.setRequestHeader('X-Cache-Only', 'false');

        xhr.onload = function() {
          if (this.status < 400) {
            processSocialPosts(JSON.parse(this.response));
            // Schedule another automatic update if we got a successful response back.
            updateSocialPostsTimeout = window.setTimeout(updateSocialPosts,
              socialPostUpdateInterval);
          }
        };

        xhr.send();
      }

      function processSocialPosts(socialPosts) {
        // Only show the first 3 posts.
        IOWA.Elements.Template.socialPosts = socialPosts.slice(0, 3);
      }

      page.load = function() {
        IOWA.Request.cacheThenNetwork(socialPostsEndpoint, processSocialPosts, processSocialPosts);
        // Set a timeout to fetch new posts after 30 seconds.
        updateSocialPostsTimeout = window.setTimeout(updateSocialPosts, socialPostUpdateInterval);

        /**
         * Transform an object into an array of its enumerable property names. Treats
         * null or undefined as the empty object.
         * @param {Object=} opt_obj
         * @return {!Array<string>}
         */
        PolymerExpressions.prototype.keysFilter = function(opt_obj) {
          return opt_obj ? Object.keys(opt_obj) : [];
        };
      };

      page.unload = function() {
        if (updateSocialPostsTimeout) {
          window.clearTimeout(updateSocialPostsTimeout);
          updateSocialPostsTimeout = null;
        }
      };

      page.load(); // Run load callback on page load.
      page.hasBeenLoaded = true;
    }

    initPage();

  })();
  </script>
{% end %}
