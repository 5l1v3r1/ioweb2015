<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element name="io-logo" attributes="height width year">
  <template>
    <link rel="stylesheet" href="io-logo.css">
    <div layout horizontal style="height:100%">
      <div id="i" class="letter" flex></div>
      <div id="slash" class="letter"></div>
      <div id="o" class="o letter" style="max-width:{{height}}px" flex layout vertical center-center>
        <div id="o2" class="o {{ {animating: animating} | tokenList }}" style="height:{{height - 20}}px;width:{{height - 20}}px" layout vertical center-center>
          <h2 id="year">{{year}}</h2>
        </div>
      </div>
    </div>
  </template>
  <script>
  Polymer({
    year: (new Date()).getYear() - 100,

    height: '165',

    width: '312',

    animating: false,
    done: false,

    SHOW_FOR: 1000,
    START_DELAY: 300,

    eventDelegates: {
      'tap': 'toggle'
    },

    ready: function() {
      this.heightChanged();
      this.widthChanged();
    },

    attached: function() {
      // this.async(function() {
        this.start();
      // }, null, 300);
    },

    heightChanged: function() {
      this.style.height = parseInt(this.height) + 'px';
    },

    widthChanged: function() {
      this.style.width = parseInt(this.width) + 'px';
    },

    start: function() {
      var GROW_DURATION = 400;

      // this.animating = !this.animating;
      // var player1 = this.$.o2.animate([
      //   {transform: 'scale(0)'},
      //   {transform: 'scale(1)'}
      // ], {
      //   delay: this.START_DELAY,
      //   // direction: 'alternate',
      //   duration: GROW_DURATION,
      //   iterations: 1,
      //   easing: 'cubic-bezier(.72,0,.28,1)',
      //   fill: 'forwards'
      // });
      // var player2 = this.$.year.animate([
      //   {opacity: '0'},
      //   {opacity: '1'}
      // ], {
      //   delay: this.START_DELAY + GROW_DURATION,
      //   // direction: 'alternate',
      //   duration: 300,
      //   iterations: 1,
      //   easing: 'ease-in-out',
      //   fill: 'forwards'
      // });

      var sequence = new AnimationSequence([
        new Animation(this.$.o2, [{transform: 'scale(0)'}, {transform: 'scale(1)'}], {
          delay: this.START_DELAY,
          // direction: 'alternate',
          duration: GROW_DURATION,
          // iterations: 1,
          easing: 'cubic-bezier(.72,0,.28,1)',
          fill: 'forwards'
        }),
        new Animation(this.$.year, [{opacity: 0}, {opacity: 1}], {
          // delay: this.START_DELAY + GROW_DURATION,
          // direction: 'alternate',
          duration: 300,
          // iterations: 1,
          easing: 'ease-in-out',
          // fill: 'both'
          fill: 'forwards'

        })
      ]);

      var iteration = 0;

      var player = document.timeline.play(sequence);

      player.onfinish = function(e) {
        iteration++;
        if (iteration >= 2) {
          player.cancel();
          this.animationDone(e);
          return;
        }

        this.async(function() {
          player.reverse();
          // player2.source.timing.delay = 0;
        }, null, this.SHOW_FOR);
      }.bind(this);
    },

    animationDone: function(e, detail, sender) {
      // if (this.done) {
      //   return;
      // }

      var player = this.parentElement.animate([
        {background: 'inherit', height: '100%'},
        {background: 'transparent', height: '66vh'}
      ], {
        duration: 300,
        iterations: 1,
        fill: 'forwards'
      });

      player.onfinish = function(e) {
        console.log(e);
      };


      // if (e.propertyName === 'opacity') {
      //   this.async(function() {
      //     this.toggle();
      //   }, null, this.SHOW_FOR);
      // } else if (!this.animating) {
      //   console.log('here')
      //   // this.parentElement.style.height = '66vh';
      //   // this.parentElement.style.background = 'transparent';
      //   var player = this.parentElement.animate([
      //     {background: 'inherit', height: '100%'},
      //     {background: 'transparent', height: '66vh'}
      //   ], {
      //     // direction: 'alternate',
      //     duration: 300,
      //     iterations: 1
      //   });
      //   player.onfinish = function(e) {
      //     console.log(e)
      //   };
      // }
    }
  });
  </script>
</polymer-element>
