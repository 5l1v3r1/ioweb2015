<!--
Copyright 2015 Google Inc. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-scroll-threshold/core-scroll-threshold.html">

<!--
Extends core-scroll-threshold to automatically trigger when an element has
entered view. `lowerElement` and `upperElement` can refer to the same or two
different elements. The elements lower and upper bounds are used to set
`lowerThreshold` and `upperThreshold`, respectively.

    <auto-scroll-threshold id="threshold" lowerElement="{{elementToWatch}}" 
      on-lower-trigger="{{loadMore}}" lowerTriggered="{{spinnerShouldShow}}">
    </auto-scroll-threshold>

For performance, the element does not watch the threshold elements for changes
to their position. If an element has moved, it should be refreshed on this
element so its position is re-measured.

@element auto-scroll-threshold
-->
<polymer-element name="auto-scroll-threshold" extends="core-scroll-threshold" attributes="lowerElement upperElement">
  <script>
    Polymer({
      /**
       * Element's whose distance from the bottom (or right, for horizontal)
       * bound of the scroller will fire the "lower trigger".
       *
       * @attribute lowerElement
       * @type Element
       * @default null
       */
      lowerElement: null,

      /**
       * Element's whose distance from the top (or left, for horizontal)
       * bound of the scroller will fire the "upper trigger".
       *
       * @attribute upperElement
       * @type Element
       * @default null
       */
      upperElement: null,

      adjustLowerBound_: function() {
        if (this.lowerElement && this.scrollTarget) {
          var elementRect = this.lowerElement.getBoundingClientRect();
          this.lowerThreshold = this.scrollTarget.scrollHeight -
              Math.round(elementRect.bottom);
        }
      },

      adjustUpperBound_: function() {
        if (this.upperElement && this.scrollTarget) {
          var elementRect = this.upperElement.getBoundingClientRect();
          this.upperThreshold = this.scrollTarget.scrollHeight -
              Math.round(elementRect.top);
        }
      },

      lowerElementChanged: function() {
        this.adjustLowerBound_();
      },

      upperElementChanged: function() {
        this.adjustUpperBound_();
      },

      scrollTargetChanged: function() {
        this.adjustLowerBound_();
        this.adjustUpperBound_();
      }
    });
  </script>
</polymer-element>
